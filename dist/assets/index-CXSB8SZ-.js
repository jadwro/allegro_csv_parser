(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const E of h.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&i(E)}).observe(document,{childList:!0,subtree:!0});function p(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerPolicy&&(h.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?h.credentials="include":o.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(o){if(o.ep)return;o.ep=!0;const h=p(o);fetch(o.href,h)}})();class Ae{constructor(n){this.data=n,this.data=n}buildTable(n){if(n.innerHTML="",this.data.length===0)return;const p=Object.keys(this.data[0]),i=n.insertRow();p.forEach(o=>{const h=document.createElement("th");h.style.fontWeight="bold",h.classList.add("border","border-gray-300","px-4","py-2","bg-gray-100"),h.textContent=o.charAt(0).toUpperCase()+o.slice(1),i.appendChild(h)}),this.data.forEach(o=>{const h=n.insertRow();p.forEach(E=>{const W=h.insertCell();W.classList.add("border","border-gray-300","px-4","py-2"),W.textContent=o[E]||""})})}}const ve=1.23;var Ce=(b=>(b.ALLEGRO="Allegro",b.VINTED="Vinted",b))(Ce||{});class Se{constructor(n,p){this.orders=n,this.products=p,this.dataTable=[],this.orders=n,this.products=p}getData(){return this.dataTable}matchItemsWithOrders(){this.dataTable=this.orders.filter(n=>!n.invoiceIssued).reverse().map((n,p)=>{const i=this.products.filter(W=>W.orderId===n.orderId),o=this.calculateShipping(n,i),h=this.handleReturns(i.map(W=>({...W}))),E=this.calculatePrice(h,o);return{id:this.generateId(p+1),date:this.formatDate(n.orderDate),products:this.createProductsList(h.map(W=>({...W}))),buyerData:this.formatBuyerData(n),shippingCost:o.toString().replace(".",","),netValue:E.netAmount.toString().replace(".",","),vatAmount:E.vatAmount.toString().replace(".",","),grossValue:E.grossAmount.toString().replace(".",","),vatRate:ve.toString().replace(".",","),transactionId:n.paymentData.paymentId,platform:Ce.ALLEGRO}})}formatDate(n){const p=String(n.getDate()).padStart(2,"0"),i=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear();return`${p}.${i}.${o}`}generateId(n){const p=new Date,i=String(p.getMonth()+1).padStart(2,"0"),o=String(p.getFullYear()).slice(-2);return`${n}_al/${i}/${o}`}handleReturns(n){return n.map(i=>{if(i.returnsQuantity===0)return i;const o=i.quantity*i.price-i.returnsQuantity*i.price,h=i.quantity-i.returnsQuantity;return i.price=o,i.quantity=h,i}).filter(i=>i!==null)}createProductsList(n){const p=n.filter(h=>h.returnsQuantity>0);let i=n.filter(h=>h.quantity>0).map(h=>`${h.productName} (${h.quantity} szt.)`).join(", ");const o=i.length>0?"; zwroty:":"Zwroty:";if(p.length>0){const h=p.map(E=>`${E.productName} (${E.returnsQuantity} szt.)`).join(", ");i+=`${o} ${h}`}return i}formatBuyerData(n){const p=n.buyerData.buyerAddress.buyerCountry==="PL"?"":`, ${n.buyerData.buyerAddress.buyerCountry}`;return`${n.buyerData.buyerName}, ${n.buyerData.buyerAddress.buyerStreet}, ${n.buyerData.buyerAddress.buyerZip} ${n.buyerData.buyerAddress.buyerCity}${p}`}calculateShipping(n,p){const i=this.sumProductsPrice(p);return+(n.paymentData.paymentAmount-i).toFixed(2)}calculatePrice(n,p){const i=this.sumProductsPrice(n)+p,o=+(i/ve).toFixed(2),h=+(i-o).toFixed(2);return{grossAmount:i.toFixed(2),netAmount:o,vatAmount:h}}sumProductsPrice(n){return n.reduce((p,i)=>p+i.quantity*i.price,0)}}class Te{displayTable(n,p,i){const o=new Se(p,i);o.matchItemsWithOrders(),new Ae(o.getData()).buildTable(n)}copyContent(n){let p="";Array.from(n.rows).forEach(i=>{Array.from(i.cells).forEach(o=>{p+=o.innerText+"	"}),p+=`
`}),navigator.clipboard.writeText(p).then(()=>alert("Zawartość tabeli skopiowana.")).catch(i=>console.error("Error: ",i))}showCopyButton(n){n.style.display="inline-block"}}var Ie=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xe(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var Ee={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(b,n){(function(p,i){b.exports=i()})(Ie,function p(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},o=!i.document&&!!i.postMessage,h=i.IS_PAPA_WORKER||!1,E={},W=0,g={parse:function(t,e){var r=(e=e||{}).dynamicTyping||!1;if(v(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.transform=!!v(e.transform)&&e.transform,e.worker&&g.WORKERS_SUPPORTED){var s=function(){if(!g.WORKERS_SUPPORTED)return!1;var f=(F=i.URL||i.webkitURL||null,R=p.toString(),g.BLOB_URL||(g.BLOB_URL=F.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",R,")();"],{type:"text/javascript"})))),y=new i.Worker(f),F,R;return y.onmessage=Re,y.id=W++,E[y.id]=y}();return s.userStep=e.step,s.userChunk=e.chunk,s.userComplete=e.complete,s.userError=e.error,e.step=v(e.step),e.chunk=v(e.chunk),e.complete=v(e.complete),e.error=v(e.error),delete e.worker,void s.postMessage({input:t,config:e,workerId:s.id})}var u=null;return g.NODE_STREAM_INPUT,typeof t=="string"?(t=function(f){return f.charCodeAt(0)===65279?f.slice(1):f}(t),u=e.download?new oe(e):new se(e)):t.readable===!0&&v(t.read)&&v(t.on)?u=new de(e):(i.File&&t instanceof File||t instanceof Object)&&(u=new ue(e)),u.stream(t)},unparse:function(t,e){var r=!1,s=!0,u=",",f=`\r
`,y='"',F=y+y,R=!1,d=null,S=!1;(function(){if(typeof e=="object"){if(typeof e.delimiter!="string"||g.BAD_DELIMITERS.filter(function(a){return e.delimiter.indexOf(a)!==-1}).length||(u=e.delimiter),(typeof e.quotes=="boolean"||typeof e.quotes=="function"||Array.isArray(e.quotes))&&(r=e.quotes),typeof e.skipEmptyLines!="boolean"&&typeof e.skipEmptyLines!="string"||(R=e.skipEmptyLines),typeof e.newline=="string"&&(f=e.newline),typeof e.quoteChar=="string"&&(y=e.quoteChar),typeof e.header=="boolean"&&(s=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");d=e.columns}e.escapeChar!==void 0&&(F=e.escapeChar+y),(typeof e.escapeFormulae=="boolean"||e.escapeFormulae instanceof RegExp)&&(S=e.escapeFormulae instanceof RegExp?e.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var l=new RegExp(ae(y),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return j(null,t,R);if(typeof t[0]=="object")return j(d||Object.keys(t[0]),t,R)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||d),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),j(t.fields||[],t.data||[],R);throw new Error("Unable to serialize unrecognized input");function j(a,k,M){var A="";typeof a=="string"&&(a=JSON.parse(a)),typeof k=="string"&&(k=JSON.parse(k));var N=Array.isArray(a)&&0<a.length,L=!Array.isArray(k[0]);if(N&&s){for(var P=0;P<a.length;P++)0<P&&(A+=u),A+=B(a[P],P);0<k.length&&(A+=f)}for(var c=0;c<k.length;c++){var m=N?a.length:k[c].length,O=!1,x=N?Object.keys(k[c]).length===0:k[c].length===0;if(M&&!N&&(O=M==="greedy"?k[c].join("").trim()==="":k[c].length===1&&k[c][0].length===0),M==="greedy"&&N){for(var C=[],z=0;z<m;z++){var T=L?a[z]:z;C.push(k[c][T])}O=C.join("").trim()===""}if(!O){for(var w=0;w<m;w++){0<w&&!x&&(A+=u);var Q=N&&L?a[w]:w;A+=B(k[c][Q],w)}c<k.length-1&&(!M||0<m&&!x)&&(A+=f)}}return A}function B(a,k){if(a==null)return"";if(a.constructor===Date)return JSON.stringify(a).slice(1,25);var M=!1;S&&typeof a=="string"&&S.test(a)&&(a="'"+a,M=!0);var A=a.toString().replace(l,F);return(M=M||r===!0||typeof r=="function"&&r(a,k)||Array.isArray(r)&&r[k]||function(N,L){for(var P=0;P<L.length;P++)if(-1<N.indexOf(L[P]))return!0;return!1}(A,g.BAD_DELIMITERS)||-1<A.indexOf(u)||A.charAt(0)===" "||A.charAt(A.length-1)===" ")?y+A+y:A}}};if(g.RECORD_SEP="",g.UNIT_SEP="",g.BYTE_ORDER_MARK="\uFEFF",g.BAD_DELIMITERS=["\r",`
`,'"',g.BYTE_ORDER_MARK],g.WORKERS_SUPPORTED=!o&&!!i.Worker,g.NODE_STREAM_INPUT=1,g.LocalChunkSize=10485760,g.RemoteChunkSize=5242880,g.DefaultDelimiter=",",g.Parser=le,g.ParserHandle=ye,g.NetworkStreamer=oe,g.FileStreamer=ue,g.StringStreamer=se,g.ReadableStreamStreamer=de,i.jQuery){var ie=i.jQuery;ie.fn.parse=function(t){var e=t.config||{},r=[];return this.each(function(f){if(!(ie(this).prop("tagName").toUpperCase()==="INPUT"&&ie(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var y=0;y<this.files.length;y++)r.push({file:this.files[y],inputElem:this,instanceConfig:ie.extend({},e)})}),s(),this;function s(){if(r.length!==0){var f,y,F,R,d=r[0];if(v(t.before)){var S=t.before(d.file,d.inputElem);if(typeof S=="object"){if(S.action==="abort")return f="AbortError",y=d.file,F=d.inputElem,R=S.reason,void(v(t.error)&&t.error({name:f},y,F,R));if(S.action==="skip")return void u();typeof S.config=="object"&&(d.instanceConfig=ie.extend(d.instanceConfig,S.config))}else if(S==="skip")return void u()}var l=d.instanceConfig.complete;d.instanceConfig.complete=function(j){v(l)&&l(j,d.file,d.inputElem),u()},g.parse(d.file,d.instanceConfig)}else v(t.complete)&&t.complete()}function u(){r.splice(0,1),s()}}}function K(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(e){var r=he(e);r.chunkSize=parseInt(r.chunkSize),e.step||e.chunk||(r.chunkSize=null),this._handle=new ye(r),(this._handle.streamer=this)._config=r}).call(this,t),this.parseChunk=function(e,r){if(this.isFirstChunk&&v(this._config.beforeFirstChunk)){var s=this._config.beforeFirstChunk(e);s!==void 0&&(e=s)}this.isFirstChunk=!1,this._halted=!1;var u=this._partialLine+e;this._partialLine="";var f=this._handle.parse(u,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var y=f.meta.cursor;this._finished||(this._partialLine=u.substring(y-this._baseIndex),this._baseIndex=y),f&&f.data&&(this._rowCount+=f.data.length);var F=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(h)i.postMessage({results:f,workerId:g.WORKER_ID,finished:F});else if(v(this._config.chunk)&&!r){if(this._config.chunk(f,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);f=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(f.data),this._completeResults.errors=this._completeResults.errors.concat(f.errors),this._completeResults.meta=f.meta),this._completed||!F||!v(this._config.complete)||f&&f.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),F||f&&f.meta.paused||this._nextChunk(),f}this._halted=!0},this._sendError=function(e){v(this._config.error)?this._config.error(e):h&&this._config.error&&i.postMessage({workerId:g.WORKER_ID,error:e,finished:!1})}}function oe(t){var e;(t=t||{}).chunkSize||(t.chunkSize=g.RemoteChunkSize),K.call(this,t),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(r){this._input=r,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),o||(e.onload=J(this._chunkLoaded,this),e.onerror=J(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var r=this._config.downloadRequestHeaders;for(var s in r)e.setRequestHeader(s,r[s])}if(this._config.chunkSize){var u=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+u)}try{e.send(this._config.downloadRequestBody)}catch(f){this._chunkError(f.message)}o&&e.status===0&&this._chunkError()}},this._chunkLoaded=function(){e.readyState===4&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:e.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(r){var s=r.getResponseHeader("Content-Range");return s===null?-1:parseInt(s.substring(s.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(r){var s=e.statusText||r;this._sendError(new Error(s))}}function ue(t){var e,r;(t=t||{}).chunkSize||(t.chunkSize=g.LocalChunkSize),K.call(this,t);var s=typeof FileReader<"u";this.stream=function(u){this._input=u,r=u.slice||u.webkitSlice||u.mozSlice,s?((e=new FileReader).onload=J(this._chunkLoaded,this),e.onerror=J(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var u=this._input;if(this._config.chunkSize){var f=Math.min(this._start+this._config.chunkSize,this._input.size);u=r.call(u,this._start,f)}var y=e.readAsText(u,this._config.encoding);s||this._chunkLoaded({target:{result:y}})},this._chunkLoaded=function(u){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(u.target.result)},this._chunkError=function(){this._sendError(e.error)}}function se(t){var e;K.call(this,t=t||{}),this.stream=function(r){return e=r,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var r,s=this._config.chunkSize;return s?(r=e.substring(0,s),e=e.substring(s)):(r=e,e=""),this._finished=!e,this.parseChunk(r)}}}function de(t){K.call(this,t=t||{});var e=[],r=!0,s=!1;this.pause=function(){K.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){K.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(u){this._input=u,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){s&&e.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):r=!0},this._streamData=J(function(u){try{e.push(typeof u=="string"?u:u.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(f){this._streamError(f)}},this),this._streamError=J(function(u){this._streamCleanUp(),this._sendError(u)},this),this._streamEnd=J(function(){this._streamCleanUp(),s=!0,this._streamData("")},this),this._streamCleanUp=J(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function ye(t){var e,r,s,u=Math.pow(2,53),f=-u,y=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,F=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,R=this,d=0,S=0,l=!1,j=!1,B=[],a={data:[],errors:[],meta:{}};if(v(t.step)){var k=t.step;t.step=function(c){if(a=c,N())A();else{if(A(),a.data.length===0)return;d+=c.data.length,t.preview&&d>t.preview?r.abort():(a.data=a.data[0],k(a,R))}}}function M(c){return t.skipEmptyLines==="greedy"?c.join("").trim()==="":c.length===1&&c[0].length===0}function A(){return a&&s&&(P("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+g.DefaultDelimiter+"'"),s=!1),t.skipEmptyLines&&(a.data=a.data.filter(function(c){return!M(c)})),N()&&function(){if(!a)return;function c(O,x){v(t.transformHeader)&&(O=t.transformHeader(O,x)),B.push(O)}if(Array.isArray(a.data[0])){for(var m=0;N()&&m<a.data.length;m++)a.data[m].forEach(c);a.data.splice(0,1)}else a.data.forEach(c)}(),function(){if(!a||!t.header&&!t.dynamicTyping&&!t.transform)return a;function c(O,x){var C,z=t.header?{}:[];for(C=0;C<O.length;C++){var T=C,w=O[C];t.header&&(T=C>=B.length?"__parsed_extra":B[C]),t.transform&&(w=t.transform(w,T)),w=L(T,w),T==="__parsed_extra"?(z[T]=z[T]||[],z[T].push(w)):z[T]=w}return t.header&&(C>B.length?P("FieldMismatch","TooManyFields","Too many fields: expected "+B.length+" fields but parsed "+C,S+x):C<B.length&&P("FieldMismatch","TooFewFields","Too few fields: expected "+B.length+" fields but parsed "+C,S+x)),z}var m=1;return!a.data.length||Array.isArray(a.data[0])?(a.data=a.data.map(c),m=a.data.length):a.data=c(a.data,0),t.header&&a.meta&&(a.meta.fields=B),S+=m,a}()}function N(){return t.header&&B.length===0}function L(c,m){return O=c,t.dynamicTypingFunction&&t.dynamicTyping[O]===void 0&&(t.dynamicTyping[O]=t.dynamicTypingFunction(O)),(t.dynamicTyping[O]||t.dynamicTyping)===!0?m==="true"||m==="TRUE"||m!=="false"&&m!=="FALSE"&&(function(x){if(y.test(x)){var C=parseFloat(x);if(f<C&&C<u)return!0}return!1}(m)?parseFloat(m):F.test(m)?new Date(m):m===""?null:m):m;var O}function P(c,m,O,x){var C={type:c,code:m,message:O};x!==void 0&&(C.row=x),a.errors.push(C)}this.parse=function(c,m,O){var x=t.quoteChar||'"';if(t.newline||(t.newline=function(T,w){T=T.substring(0,1048576);var Q=new RegExp(ae(w)+"([^]*?)"+ae(w),"gm"),q=(T=T.replace(Q,"")).split("\r"),V=T.split(`
`),Z=1<V.length&&V[0].length<q[0].length;if(q.length===1||Z)return`
`;for(var U=0,D=0;D<q.length;D++)q[D][0]===`
`&&U++;return U>=q.length/2?`\r
`:"\r"}(c,x)),s=!1,t.delimiter)v(t.delimiter)&&(t.delimiter=t.delimiter(c),a.meta.delimiter=t.delimiter);else{var C=function(T,w,Q,q,V){var Z,U,D,I;V=V||[",","	","|",";",g.RECORD_SEP,g.UNIT_SEP];for(var te=0;te<V.length;te++){var _=V[te],ne=0,G=0,re=0;D=void 0;for(var Y=new le({comments:q,delimiter:_,newline:w,preview:10}).parse(T),X=0;X<Y.data.length;X++)if(Q&&M(Y.data[X]))re++;else{var ee=Y.data[X].length;G+=ee,D!==void 0?0<ee&&(ne+=Math.abs(ee-D),D=ee):D=ee}0<Y.data.length&&(G/=Y.data.length-re),(U===void 0||ne<=U)&&(I===void 0||I<G)&&1.99<G&&(U=ne,Z=_,I=G)}return{successful:!!(t.delimiter=Z),bestDelimiter:Z}}(c,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);C.successful?t.delimiter=C.bestDelimiter:(s=!0,t.delimiter=g.DefaultDelimiter),a.meta.delimiter=t.delimiter}var z=he(t);return t.preview&&t.header&&z.preview++,e=c,r=new le(z),a=r.parse(e,m,O),A(),l?{meta:{paused:!0}}:a||{meta:{paused:!1}}},this.paused=function(){return l},this.pause=function(){l=!0,r.abort(),e=v(t.chunk)?"":e.substring(r.getCharIndex())},this.resume=function(){R.streamer._halted?(l=!1,R.streamer.parseChunk(e,!0)):setTimeout(R.resume,3)},this.aborted=function(){return j},this.abort=function(){j=!0,r.abort(),a.meta.aborted=!0,v(t.complete)&&t.complete(a),e=""}}function ae(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function le(t){var e,r=(t=t||{}).delimiter,s=t.newline,u=t.comments,f=t.step,y=t.preview,F=t.fastMode,R=e=t.quoteChar===void 0||t.quoteChar===null?'"':t.quoteChar;if(t.escapeChar!==void 0&&(R=t.escapeChar),(typeof r!="string"||-1<g.BAD_DELIMITERS.indexOf(r))&&(r=","),u===r)throw new Error("Comment character same as delimiter");u===!0?u="#":(typeof u!="string"||-1<g.BAD_DELIMITERS.indexOf(u))&&(u=!1),s!==`
`&&s!=="\r"&&s!==`\r
`&&(s=`
`);var d=0,S=!1;this.parse=function(l,j,B){if(typeof l!="string")throw new Error("Input must be a string");var a=l.length,k=r.length,M=s.length,A=u.length,N=v(f),L=[],P=[],c=[],m=d=0;if(!l)return $();if(t.header&&!j){var O=l.split(s)[0].split(r),x=[],C={},z=!1;for(var T in O){var w=O[T];v(t.transformHeader)&&(w=t.transformHeader(w,T));var Q=w,q=C[w]||0;for(0<q&&(z=!0,Q=w+"_"+q),C[w]=q+1;x.includes(Q);)Q=Q+"_"+q;x.push(Q)}if(z){var V=l.split(s);V[0]=x.join(r),l=V.join(s)}}if(F||F!==!1&&l.indexOf(e)===-1){for(var Z=l.split(s),U=0;U<Z.length;U++){if(c=Z[U],d+=c.length,U!==Z.length-1)d+=s.length;else if(B)return $();if(!u||c.substring(0,A)!==u){if(N){if(L=[],re(c.split(r)),ce(),S)return $()}else re(c.split(r));if(y&&y<=U)return L=L.slice(0,y),$(!0)}}return $()}for(var D=l.indexOf(r,d),I=l.indexOf(s,d),te=new RegExp(ae(R)+ae(e),"g"),_=l.indexOf(e,d);;)if(l[d]!==e)if(u&&c.length===0&&l.substring(d,d+A)===u){if(I===-1)return $();d=I+M,I=l.indexOf(s,d),D=l.indexOf(r,d)}else if(D!==-1&&(D<I||I===-1))c.push(l.substring(d,D)),d=D+k,D=l.indexOf(r,d);else{if(I===-1)break;if(c.push(l.substring(d,I)),ee(I+M),N&&(ce(),S))return $();if(y&&L.length>=y)return $(!0)}else for(_=d,d++;;){if((_=l.indexOf(e,_+1))===-1)return B||P.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:L.length,index:d}),X();if(_===a-1)return X(l.substring(d,_).replace(te,e));if(e!==R||l[_+1]!==R){if(e===R||_===0||l[_-1]!==R){D!==-1&&D<_+1&&(D=l.indexOf(r,_+1)),I!==-1&&I<_+1&&(I=l.indexOf(s,_+1));var ne=Y(I===-1?D:Math.min(D,I));if(l.substr(_+1+ne,k)===r){c.push(l.substring(d,_).replace(te,e)),l[d=_+1+ne+k]!==e&&(_=l.indexOf(e,d)),D=l.indexOf(r,d),I=l.indexOf(s,d);break}var G=Y(I);if(l.substring(_+1+G,_+1+G+M)===s){if(c.push(l.substring(d,_).replace(te,e)),ee(_+1+G+M),D=l.indexOf(r,d),_=l.indexOf(e,d),N&&(ce(),S))return $();if(y&&L.length>=y)return $(!0);break}P.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:L.length,index:d}),_++}}else _++}return X();function re(H){L.push(H),m=d}function Y(H){var be=0;if(H!==-1){var fe=l.substring(_+1,H);fe&&fe.trim()===""&&(be=fe.length)}return be}function X(H){return B||(H===void 0&&(H=l.substring(d)),c.push(H),d=a,re(c),N&&ce()),$()}function ee(H){d=H,re(c),c=[],I=l.indexOf(s,d)}function $(H){return{data:L,errors:P,meta:{delimiter:r,linebreak:s,aborted:S,truncated:!!H,cursor:m+(j||0)}}}function ce(){f($()),L=[],P=[]}},this.abort=function(){S=!0},this.getCharIndex=function(){return d}}function Re(t){var e=t.data,r=E[e.workerId],s=!1;if(e.error)r.userError(e.error,e.file);else if(e.results&&e.results.data){var u={abort:function(){s=!0,me(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:_e,resume:_e};if(v(r.userStep)){for(var f=0;f<e.results.data.length&&(r.userStep({data:e.results.data[f],errors:e.results.errors,meta:e.results.meta},u),!s);f++);delete e.results}else v(r.userChunk)&&(r.userChunk(e.results,u,e.file),delete e.results)}e.finished&&!s&&me(e.workerId,e.results)}function me(t,e){var r=E[t];v(r.userComplete)&&r.userComplete(e),r.terminate(),delete E[t]}function _e(){throw new Error("Not implemented.")}function he(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var r in t)e[r]=he(t[r]);return e}function J(t,e){return function(){t.apply(e,arguments)}}function v(t){return typeof t=="function"}return h&&(i.onmessage=function(t){var e=t.data;if(g.WORKER_ID===void 0&&e&&(g.WORKER_ID=e.workerId),typeof e.input=="string")i.postMessage({workerId:g.WORKER_ID,results:g.parse(e.input,e.config),finished:!0});else if(i.File&&e.input instanceof File||e.input instanceof Object){var r=g.parse(e.input,e.config);r&&i.postMessage({workerId:g.WORKER_ID,results:r,finished:!0})}}),(oe.prototype=Object.create(K.prototype)).constructor=oe,(ue.prototype=Object.create(K.prototype)).constructor=ue,(se.prototype=Object.create(se.prototype)).constructor=se,(de.prototype=Object.create(K.prototype)).constructor=de,g})})(Ee);var Le=Ee.exports;const we=xe(Le);var ke=(b=>(b.PROCESSING="PROCESSING",b.SENT="SENT",b.CANCELLED="CANCELLED",b))(ke||{});class Pe{constructor(){this.orders=[]}getOrders(){return this.orders??(()=>{throw Error("NO ORDERS FOUND")})()}async parseOrderCSV(n){this.orders=await new Promise((p,i)=>{we.parse(n,{header:!0,skipEmptyLines:!0,complete:o=>{const E=o.data.map(this.mapOrderCSV).filter(Boolean);console.log(E),p(E)},error:o=>i(o)})})}mapOrderCSV(n){return n.SellerStatus===ke.CANCELLED?null:{orderId:n.OrderId,orderDate:new Date(n.OrderDate),buyerData:{buyerName:n.BuyerName,buyerAddress:{buyerStreet:n.BuyerAddress,buyerZip:n.BuyerZip,buyerCity:n.BuyerCity,buyerCountry:n.BuyerCountryCode}},paymentData:{paymentId:n.PaymentId,paymentAmount:+n.TotalToPayAmount,paymentCurrency:n.PaymentCurrency},invoiceIssued:n.InvoiceTaxId!==""}}}class Fe{constructor(){this.products=[]}getProducts(){return this.products??(()=>{throw Error("NO PRODUCTS FOUND")})()}async parseProductCSV(n){this.products=await new Promise((p,i)=>{we.parse(n,{header:!0,skipEmptyLines:!0,complete:o=>{const E=o.data.map(this.mapProductCSV).filter(Boolean);p(E)},error:o=>i(o)})})}mapProductCSV(n){return{orderId:n.OrderId,productName:n.Name,quantity:+n.Quantity,price:+n.Price,returnsQuantity:+n.ReturnsQuantity}}}class Ne{constructor(n){this.file=n,this.file=n}getParsedData(){if(this.parsedData===void 0)throw new Error("Orders or products are undefined!");return this.parsedData}async uploadAndProcessFile(){const p=(await this.file.text()).split(/\n\s*\n/),i=p[0],o=p[1],h=new Pe;await h.parseOrderCSV(i);const E=new Fe;await E.parseProductCSV(o),this.parsedData={orders:h.getOrders(),products:E.getProducts()}}}const pe=document.getElementById("uploadCsvFile"),Be=document.getElementById("uploadButton"),Oe=document.getElementById("dataTable"),De=document.getElementById("copyContentButton"),ge=new Te;Be.addEventListener("click",async()=>{if(pe.files&&pe.files[0]){const b=new Ne(pe.files[0]);await b.uploadAndProcessFile();const n=b.getParsedData();ge.displayTable(Oe,n.orders,n.products),ge.showCopyButton(De)}else alert("Please select a CSV file.")});De.addEventListener("click",()=>{ge.copyContent(Oe)});
